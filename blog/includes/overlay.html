<script>

  function Overlay(name, li_margin) {
    let parent = document.getElementById(name)
    let floaty_container = document.getElementsByClassName("floaty-container")[0]
    let overlay = Array.from(parent.getElementsByClassName("overlay"))[0]
    let overlay_content = Array.from(parent.getElementsByClassName("overlay-content"))[0]
    let overlay_content_children = Array.from(overlay_content.getElementsByClassName("overlay-content-item"))

    if (!floaty_container) { console.error(`Could not find floaty.`) }
    if (!overlay) { console.error(`Could not find overlay for \`${name}\`.`) }
    if (!overlay_content) { console.error(`Could not find overlay_content for \`${name}\`.`) }

    function hideOverlay() {
      overlay.style.display = "none";
      overlay_content.style.display = "none"
      overlay_content_children.map(child => {child.style.display = 'none'})
    }

    function showOverlay() {
      overlay.style.display = "flex";
      overlay_content.style.display = "block";
    }

    function onClickIcon (icon) {
      return function() {
        showOverlay()
        overlay_content_children[icon.dataset.key].style.display = 'block'
      }
    }

    function setListItemSize(icon){
      const size = parseInt(icon.style['font-size'])

      // NOTE: This makes it so that size should always be specified in pixels.
      const li = icon.closest("li")
      if (li){
        li.style.height = `${size}px`
        li.style.width = `${size}px`
        console.log(li_margin, size)
        li.style.margin = `${li_margin || (size / 4)}px`
      }
    }



    let icons = Array.from(floaty_container.getElementsByTagName("iconify-icon"))
    icons.map(icon => {
      icon.addEventListener("click", onClickIcon(icon))
      setListItemSize(icon)
    })


    // NOTE: For now, clicking anywhere on the overlay should hide it.
    hideOverlay(name)
    overlay.addEventListener("click", hideOverlay)

    return { icons, hideOverlay, showOverlay, overlay, overlay_content, overlay_content_children }
  }

</script>

